<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.5">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4689cc; -webkit-text-stroke: #4689cc}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #8cd3fe; -webkit-text-stroke: #8cd3fe}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #c27e65; -webkit-text-stroke: #c27e65}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d7378; -webkit-text-stroke: #6d7378}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 16.0px}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #71c083; -webkit-text-stroke: #71c083}
    span.s1 {font-kerning: none; background-color: #171818}
    span.s2 {font-kerning: none; color: #8cd3fe; background-color: #171818; -webkit-text-stroke: 0px #8cd3fe}
    span.s3 {font-kerning: none; color: #6d6d6d; background-color: #171818; -webkit-text-stroke: 0px #6d6d6d}
    span.s4 {font-kerning: none; color: #cacaca; background-color: #171818; -webkit-text-stroke: 0px #cacaca}
    span.s5 {font-kerning: none; color: #c27e65; background-color: #171818; -webkit-text-stroke: 0px #c27e65}
    span.s6 {font-kerning: none; color: #4689cc; background-color: #171818; -webkit-text-stroke: 0px #4689cc}
    span.s7 {font-kerning: none; color: #d4d4d4; background-color: #171818; -webkit-text-stroke: 0px #d4d4d4}
    span.s8 {font-kerning: none; color: #71c083; background-color: #171818; -webkit-text-stroke: 0px #71c083}
    span.s9 {font-kerning: none; color: #a7c598; background-color: #171818; -webkit-text-stroke: 0px #a7c598}
    span.s10 {font-kerning: none}
    span.s11 {font-kerning: none; color: #b76ff7; background-color: #171818; -webkit-text-stroke: 0px #b76ff7}
    span.s12 {font-kerning: none; color: #6d7378; background-color: #171818; -webkit-text-stroke: 0px #6d7378}
    span.s13 {font-kerning: none; color: #f67c30; background-color: #171818; -webkit-text-stroke: 0px #f67c30}
    span.s14 {font-kerning: none; color: #36c0a0; background-color: #171818; -webkit-text-stroke: 0px #36c0a0}
    span.s15 {font-kerning: none; color: #a34f83; background-color: #171818; -webkit-text-stroke: 0px #a34f83}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"en"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">JSON to CSV Converter</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">link</span><span class="s4"> </span><span class="s2">href</span><span class="s3">=</span><span class="s1">"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"</span><span class="s4"> </span><span class="s2">rel</span><span class="s3">=</span><span class="s1">"stylesheet"</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">body</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">font-family:</span><span class="s1"> </span><span class="s8">'Inter'</span><span class="s7">,</span><span class="s1"> </span><span class="s5">sans-serif</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">/* Custom style for the file drop zone */</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.drop-zone</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border:</span><span class="s1"> </span><span class="s9">2px</span><span class="s1"> </span><span class="s5">dashed</span><span class="s1"> #cbd5e1</span><span class="s7">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">background-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s7">,</span><span class="s4"> </span><span class="s1">border-color</span><span class="s4"> </span><span class="s9">0.2s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">.drop-zone-over</span><span class="s4"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">border-color:</span><span class="s1"> #3b82f6</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">background-color:</span><span class="s1"> #eff6ff</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-gray-100 flex items-center justify-center min-h-screen p-4"</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container w-full max-w-3xl mx-auto bg-white rounded-xl shadow-lg p-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center mb-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h1</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-3xl font-bold text-gray-800"</span><span class="s3">&gt;</span><span class="s1">JSON to CSV Converter</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-500 mt-2"</span><span class="s3">&gt;</span><span class="s1">Paste your JSON data or upload a file to seamlessly convert it into a downloadable CSV.</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- JSON Input Text Area --&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"mb-6"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"jsonInput"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"block text-sm font-medium text-gray-700 mb-2"</span><span class="s3">&gt;</span><span class="s4">JSON Input</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">textarea</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"jsonInput"</span><span class="s4"> </span><span class="s2">placeholder</span><span class="s3">=</span><span class="s1">'Paste your JSON here...'</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full h-48 p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out font-mono text-sm"</span><span class="s3">&gt;&lt;/</span><span class="s6">textarea</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- File Upload / Drop Zone --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileInputWrapper"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"drop-zone rounded-lg p-8 text-center cursor-pointer mb-6 bg-gray-50 hover:bg-gray-100"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">svg</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mx-auto h-12 w-12 text-gray-400"</span><span class="s4"> </span><span class="s2">stroke</span><span class="s3">=</span><span class="s1">"currentColor"</span><span class="s4"> </span><span class="s2">fill</span><span class="s3">=</span><span class="s1">"none"</span><span class="s4"> </span><span class="s2">viewBox</span><span class="s3">=</span><span class="s1">"0 0 48 48"</span><span class="s4"> </span><span class="s2">aria-hidden</span><span class="s3">=</span><span class="s1">"true"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">path</span><span class="s4"> </span><span class="s2">d</span><span class="s3">=</span><span class="s1">"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28"</span><span class="s4"> </span><span class="s2">stroke-width</span><span class="s3">=</span><span class="s1">"2"</span><span class="s4"> </span><span class="s2">stroke-linecap</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s2">stroke-linejoin</span><span class="s3">=</span><span class="s1">"round"</span><span class="s4"> </span><span class="s3">/&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">svg</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 text-sm text-gray-600"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">span</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"font-semibold text-blue-600"</span><span class="s3">&gt;</span><span class="s1">Click to upload</span><span class="s3">&lt;/</span><span class="s6">span</span><span class="s3">&gt;</span><span class="s1"> or drag and drop a .json file</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"file"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileInput"</span><span class="s4"> </span><span class="s2">accept</span><span class="s3">=</span><span class="s1">".json"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"fileName"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-2 text-xs text-gray-500"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Action Buttons --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"grid grid-cols-1 md:grid-cols-2 gap-4 mt-8"</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"convertBtn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>Convert to CSV</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"downloadBtn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full bg-green-600 text-white font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out"</span><span class="s4"> </span><span class="s2">style</span><span class="s3">=</span><span class="s1">"display: none;"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>Download converted-data.csv</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">&lt;!-- Status Message Area --&gt;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"status"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-6 text-center text-sm font-medium"</span><span class="s3">&gt;&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- DOM Element References ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> jsonInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'jsonInput'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> convertBtn </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'convertBtn'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> downloadBtn </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'downloadBtn'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> statusDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'status'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileInput </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileInput'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileInputWrapper </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileInputWrapper'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">const</span><span class="s1"> fileNameDiv </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">getElementById</span><span class="s7">(</span><span class="s8">'fileName'</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s11">let</span><span class="s4"> csvContent </span><span class="s7">=</span><span class="s4"> </span><span class="s11">null</span><span class="s7">;</span><span class="s4"> </span><span class="s1">// To store the generated CSV data</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Event Listeners ---</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>convertBtn</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> handleConversion</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> fileInput</span><span class="s7">.</span><span class="s1">click</span><span class="s7">());</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInput</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'change'</span><span class="s7">,</span><span class="s1"> handleFileSelect</span><span class="s7">);</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Drag and drop listeners for the wrapper</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'dragover'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>event</span><span class="s7">.</span><span class="s1">preventDefault</span><span class="s7">();</span><span class="s1"> </span><span class="s12">// Necessary to allow drop</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">add</span><span class="s7">(</span><span class="s8">'drop-zone-over'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'dragleave'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'drop-zone-over'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'drop'</span><span class="s7">,</span><span class="s1"> handleFileDrop</span><span class="s7">);</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// --- Functions ---</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Handles the file selection from the input element.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Reads the selected file and populates the textarea.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {Event} event The file input change event.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> handleFileSelect</span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s13">0</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>readFile</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Handles a file being dropped into the drop zone.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {DragEvent} event The drop event.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> handleFileDrop</span><span class="s7">(</span><span class="s1">event</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>event</span><span class="s7">.</span><span class="s1">preventDefault</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>fileInputWrapper</span><span class="s7">.</span><span class="s1">classList</span><span class="s7">.</span><span class="s1">remove</span><span class="s7">(</span><span class="s8">'drop-zone-over'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> file </span><span class="s7">=</span><span class="s1"> event</span><span class="s7">.</span><span class="s1">dataTransfer</span><span class="s7">.</span><span class="s1">files</span><span class="s7">[</span><span class="s13">0</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">file </span><span class="s7">&amp;&amp;</span><span class="s1"> file</span><span class="s7">.</span><span class="s1">type </span><span class="s7">===</span><span class="s1"> </span><span class="s8">'application/json'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>readFile</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">else</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileNameDiv</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'Please drop a valid .json file.'</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s1">'Invalid file type. Please upload a .json file.'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'error'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Reads a file using FileReader and updates the UI.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {File} file The file to read.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> readFile</span><span class="s7">(</span><span class="s1">file</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> reader </span><span class="s7">=</span><span class="s1"> </span><span class="s11">new</span><span class="s1"> </span><span class="s14">FileReader</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">onload </span><span class="s7">=</span><span class="s1"> </span><span class="s7">(</span><span class="s1">e</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>jsonInput</span><span class="s7">.</span><span class="s1">value </span><span class="s7">=</span><span class="s1"> e</span><span class="s7">.</span><span class="s1">target</span><span class="s7">.</span><span class="s1">result</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>fileNameDiv</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> </span><span class="s8">`File loaded: </span><span class="s7">${</span><span class="s1">file</span><span class="s7">.</span><span class="s1">name</span><span class="s7">}</span><span class="s8">`</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s1">'File loaded successfully. Ready to convert.'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'success'</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span>downloadBtn</span><span class="s7">.</span><span class="s4">style</span><span class="s7">.</span><span class="s4">display </span><span class="s7">=</span><span class="s4"> </span><span class="s8">'none'</span><span class="s7">;</span><span class="s4"> </span><span class="s1">// Hide download button if a new file is loaded</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">onerror </span><span class="s7">=</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s8">`Error reading file: </span><span class="s7">${</span><span class="s1">reader</span><span class="s7">.</span><span class="s1">error</span><span class="s7">}</span><span class="s8">`</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'error'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>reader</span><span class="s7">.</span><span class="s1">readAsText</span><span class="s7">(</span><span class="s1">file</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Main function to trigger the JSON parsing and conversion process.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> handleConversion</span><span class="s7">()</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> jsonText </span><span class="s7">=</span><span class="s1"> jsonInput</span><span class="s7">.</span><span class="s1">value</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">jsonText</span><span class="s7">.</span><span class="s1">trim</span><span class="s7">())</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s1">'Input is empty. Please paste JSON or upload a file.'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'error'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">try</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// Remove potential non-JSON text before the opening brace</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> firstBraceIndex </span><span class="s7">=</span><span class="s1"> jsonText</span><span class="s7">.</span><span class="s1">indexOf</span><span class="s7">(</span><span class="s8">'{'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> cleanJsonText </span><span class="s7">=</span><span class="s1"> firstBraceIndex </span><span class="s7">!==</span><span class="s1"> </span><span class="s7">-</span><span class="s13">1</span><span class="s1"> </span><span class="s7">?</span><span class="s1"> jsonText</span><span class="s7">.</span><span class="s1">substring</span><span class="s7">(</span><span class="s1">firstBraceIndex</span><span class="s7">)</span><span class="s1"> </span><span class="s7">:</span><span class="s1"> jsonText</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> data </span><span class="s7">=</span><span class="s1"> </span><span class="s14">JSON</span><span class="s7">.</span><span class="s1">parse</span><span class="s7">(</span><span class="s1">cleanJsonText</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>csvContent </span><span class="s7">=</span><span class="s1"> convertJsonToCsv</span><span class="s7">(</span><span class="s1">data</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">csvContent</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                    </span>showStatus</span><span class="s7">(</span><span class="s1">'Conversion successful! Click the download button.'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'success'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>downloadBtn</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">display </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'block'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span><span class="s1"> </span><span class="s11">catch</span><span class="s1"> </span><span class="s7">(</span><span class="s1">error</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s1">`Error parsing JSON: </span><span class="s7">${</span><span class="s4">error</span><span class="s7">.</span><span class="s4">message</span><span class="s7">}</span><span class="s1">. Please ensure it is valid.`</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'error'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>csvContent </span><span class="s7">=</span><span class="s1"> </span><span class="s11">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>downloadBtn</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">display </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'none'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Converts the parsed JSON object into a CSV string.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {object} data The parsed JSON data.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @returns {string|null} The CSV content as a string, or null on error.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> convertJsonToCsv</span><span class="s7">(</span><span class="s1">data</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(!</span><span class="s1">data</span><span class="s7">.</span><span class="s1">table </span><span class="s7">||</span><span class="s1"> </span><span class="s7">!</span><span class="s1">data</span><span class="s7">.</span><span class="s1">locationKeyToName </span><span class="s7">||</span><span class="s1"> </span><span class="s7">!</span><span class="s1">data</span><span class="s7">.</span><span class="s1">trades</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">                </span>showStatus</span><span class="s7">(</span><span class="s1">'Error: JSON is missing required keys: "table", "locationKeyToName", or "trades".'</span><span class="s7">,</span><span class="s4"> </span><span class="s1">'error'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s1"> </span><span class="s11">null</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> table</span><span class="s7">,</span><span class="s1"> locationKeyToName</span><span class="s7">,</span><span class="s1"> trades </span><span class="s7">}</span><span class="s1"> </span><span class="s7">=</span><span class="s1"> data</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Using a Set to ensure unique headers, then converting back to an array</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> uniqueTrades </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[...</span><span class="s11">new</span><span class="s1"> </span><span class="s14">Set</span><span class="s7">(</span><span class="s1">trades</span><span class="s7">)];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> headers </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[</span><span class="s8">'Date'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'Location ID'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'Location Name'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">...</span><span class="s1">uniqueTrades</span><span class="s7">];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// Function to escape commas and quotes within a CSV field</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> escapeCsvField </span><span class="s7">=</span><span class="s1"> </span><span class="s7">(</span><span class="s1">field</span><span class="s7">)</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">field </span><span class="s7">===</span><span class="s1"> </span><span class="s11">null</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> field </span><span class="s7">===</span><span class="s1"> </span><span class="s11">undefined</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">return</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> stringField </span><span class="s7">=</span><span class="s1"> </span><span class="s14">String</span><span class="s7">(</span><span class="s1">field</span><span class="s7">);</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s1">// If the field contains a comma, a quote, or a newline, enclose it in double quotes</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">stringField</span><span class="s7">.</span><span class="s1">includes</span><span class="s7">(</span><span class="s8">','</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> stringField</span><span class="s7">.</span><span class="s1">includes</span><span class="s7">(</span><span class="s8">'"'</span><span class="s7">)</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> stringField</span><span class="s7">.</span><span class="s1">includes</span><span class="s7">(</span><span class="s8">'\n'</span><span class="s7">))</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p5"><span class="s4"><span class="Apple-converted-space">                    </span></span><span class="s1">// Escape existing double quotes by doubling them up</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">return</span><span class="s1"> </span><span class="s8">`"</span><span class="s7">${</span><span class="s1">stringField</span><span class="s7">.</span><span class="s1">replace</span><span class="s7">(</span><span class="s15">/"/</span><span class="s11">g</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'""'</span><span class="s7">)}</span><span class="s8">"`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">return</span><span class="s1"> stringField</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">};</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">const</span><span class="s1"> csvRows </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[</span><span class="s1">headers</span><span class="s7">.</span><span class="s1">map</span><span class="s7">(</span><span class="s1">escapeCsvField</span><span class="s7">).</span><span class="s1">join</span><span class="s7">(</span><span class="s8">','</span><span class="s7">)];</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">for</span><span class="s1"> </span><span class="s7">(</span><span class="s11">const</span><span class="s1"> date </span><span class="s11">in</span><span class="s1"> table</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> locations </span><span class="s7">=</span><span class="s1"> table</span><span class="s7">[</span><span class="s1">date</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">for</span><span class="s1"> </span><span class="s7">(</span><span class="s11">const</span><span class="s1"> locationId </span><span class="s11">in</span><span class="s1"> locations</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">const</span><span class="s1"> locationData </span><span class="s7">=</span><span class="s1"> locations</span><span class="s7">[</span><span class="s1">locationId</span><span class="s7">];</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">const</span><span class="s1"> locationName </span><span class="s7">=</span><span class="s1"> locationKeyToName</span><span class="s7">[</span><span class="s1">locationId</span><span class="s7">]</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> </span><span class="s8">'Unknown Location'</span><span class="s7">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">const</span><span class="s1"> row </span><span class="s7">=</span><span class="s1"> </span><span class="s7">[</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>escapeCsvField</span><span class="s7">(</span><span class="s1">date</span><span class="s7">),</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>escapeCsvField</span><span class="s7">(</span><span class="s1">locationId</span><span class="s7">),</span><span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>escapeCsvField</span><span class="s7">(</span><span class="s1">locationName</span><span class="s7">)</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">];</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s11">for</span><span class="s1"> </span><span class="s7">(</span><span class="s11">const</span><span class="s1"> trade </span><span class="s11">of</span><span class="s1"> uniqueTrades</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span></span><span class="s11">const</span><span class="s1"> status </span><span class="s7">=</span><span class="s1"> locationData</span><span class="s7">[</span><span class="s1">trade</span><span class="s7">]</span><span class="s1"> </span><span class="s7">||</span><span class="s1"> </span><span class="s8">''</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                        </span>row</span><span class="s7">.</span><span class="s1">push</span><span class="s7">(</span><span class="s1">escapeCsvField</span><span class="s7">(</span><span class="s1">status</span><span class="s7">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                    </span>csvRows</span><span class="s7">.</span><span class="s1">push</span><span class="s7">(</span><span class="s1">row</span><span class="s7">.</span><span class="s1">join</span><span class="s7">(</span><span class="s8">','</span><span class="s7">));</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">return</span><span class="s1"> csvRows</span><span class="s7">.</span><span class="s1">join</span><span class="s7">(</span><span class="s8">'\n'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Triggers the download of the generated CSV file.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span>downloadBtn</span><span class="s7">.</span><span class="s1">addEventListener</span><span class="s7">(</span><span class="s8">'click'</span><span class="s7">,</span><span class="s1"> </span><span class="s7">()</span><span class="s1"> </span><span class="s7">=&gt;</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s11">if</span><span class="s1"> </span><span class="s7">(</span><span class="s1">csvContent</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> blob </span><span class="s7">=</span><span class="s1"> </span><span class="s11">new</span><span class="s1"> </span><span class="s14">Blob</span><span class="s7">([</span><span class="s1">csvContent</span><span class="s7">],</span><span class="s1"> </span><span class="s7">{</span><span class="s1"> type</span><span class="s7">:</span><span class="s1"> </span><span class="s8">'text/csv;charset=utf-8;'</span><span class="s1"> </span><span class="s7">});</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> link </span><span class="s7">=</span><span class="s1"> document</span><span class="s7">.</span><span class="s1">createElement</span><span class="s7">(</span><span class="s8">'a'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s11">const</span><span class="s1"> url </span><span class="s7">=</span><span class="s1"> </span><span class="s14">URL</span><span class="s7">.</span><span class="s1">createObjectURL</span><span class="s7">(</span><span class="s1">blob</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">setAttribute</span><span class="s7">(</span><span class="s8">'href'</span><span class="s7">,</span><span class="s1"> url</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">setAttribute</span><span class="s7">(</span><span class="s8">'download'</span><span class="s7">,</span><span class="s1"> </span><span class="s8">'converted-data.csv'</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">style</span><span class="s7">.</span><span class="s1">visibility </span><span class="s7">=</span><span class="s1"> </span><span class="s8">'hidden'</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">appendChild</span><span class="s7">(</span><span class="s1">link</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>link</span><span class="s7">.</span><span class="s1">click</span><span class="s7">();</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">                </span>document</span><span class="s7">.</span><span class="s1">body</span><span class="s7">.</span><span class="s1">removeChild</span><span class="s7">(</span><span class="s1">link</span><span class="s7">);</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">}</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">});</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">/**</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* Displays a status message to the user.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} message The message to display.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>* @param {string} type 'success' or 'error'.</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span>*/</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s11">function</span><span class="s1"> showStatus</span><span class="s7">(</span><span class="s1">message</span><span class="s7">,</span><span class="s1"> type</span><span class="s7">)</span><span class="s1"> </span><span class="s7">{</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">            </span>statusDiv</span><span class="s7">.</span><span class="s1">textContent </span><span class="s7">=</span><span class="s1"> message</span><span class="s7">;</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">            </span>statusDiv</span><span class="s7">.</span><span class="s4">className </span><span class="s7">=</span><span class="s4"> </span><span class="s1">`mt-6 text-center text-sm font-medium </span><span class="s7">${</span><span class="s4">type </span><span class="s7">===</span><span class="s4"> </span><span class="s1">'success'</span><span class="s4"> </span><span class="s7">?</span><span class="s4"> </span><span class="s1">'text-green-600'</span><span class="s4"> </span><span class="s7">:</span><span class="s4"> </span><span class="s1">'text-red-600'</span><span class="s7">}</span><span class="s1">`</span><span class="s7">;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">}</span></p>
<p class="p6"><span class="s10"></span><br></p>
<p class="p1"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p1"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
</body>
</html>
